# voucher

## Database
MySQL
You can find the SQL code on "database.sql" file located on "cmd" folder;

To configure database, search this code on "database.sql" file:
```
$DB_CONNECTION = array(
  'Cloud platform' => 'AWS Amazon',
  'Server Location' => 'South America (SÃ£o Paulo)',
  'DB Instance Identifier' => 'DB Instace',
  'URL' => 'DB URL',
  'DB Name' => 'DB NAME',
  'Username' => 'DB USERNAME',
  'Password' => 'DB PASSWORD'
);
```

All commands are made by Stored Procedures.

To connect to database I create my own class, inherited from PDO. There are some tricks with my class, called "ConnDB", the statement is controled, you can debug the parameters by call the function "GetParameters" from the "Prepated Statement". For example:
```
$sql = 'SELECT NAME FROM TABLE WHERE ID = :id;';
$qry = $connection->prepare($sql);
$qry->bindParam(':id', $id);
$qry->execute();
print_r($qry->GetParameters());
```
This is very useful to store a complete autit system.

## Classes
The classes are organized by what they do. You can see below:

customers.php
Get the parameters and follow the calls

customer_model.php
Execute all calls from customer.php
Add customer
Edit a customer
Remove a customer
Query customers

special_offer.php
Get the parameters and follow the calls

special_offer_model.php
Execute all calls from special_offer.php
Add a new special offer
Edit a special offer
Delete a special offer
Query special offer

voucher.php
Get the parameters and follow the calls

voucher_model.php
Execute all calls from voucher.php
Add a new voucher
Query a voucher by customer email and a code

## Voucher Code
The voucher code is generated by the database. It is unique and it can be used only one time.
A customer can have the same offer many times, but only one active offer at the same type.

## The site
All calls are made by async requests.

# How can it improves?
You can add a layer to ensure security. The database is commanded by Stored Procedures and you can use the User Id and User Authentication to control the user and his session.
